!function(t){"use strict";function i(){var i=l.clientHeight,e=t.innerHeight;return e>i?e:i}function e(){return t.pageYOffset||l.scrollTop}function n(t){var i=0,e=0;do isNaN(t.offsetTop)||(i+=t.offsetTop),isNaN(t.offsetLeft)||(e+=t.offsetLeft);while(t=t.offsetParent);return{top:i,left:e}}function s(t,s){var o=t.offsetHeight,a=e(),r=a+i(),l=n(t).top,c=l+o,s=s||0;return r>=l+o*s&&c-o*s>=a}function o(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);return t}function a(t){this.el=t,this.anchor=t.querySelector("a"),this.image=t.querySelector("img"),this.desc=t.querySelector("h3")}function r(t,i){this.el=t,this.options=o({},this.options),o(this.options,i),this._init()}var l=t.document.documentElement,c={animations:Modernizr.cssanimations},m={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},h=m[Modernizr.prefixed("animation")];a.prototype.addCurtain=function(){if(this.image){this.curtain=document.createElement("div"),this.curtain.className="curtain";var t=new ColorFinder(function(t,i,e){return(Math.abs(t-i)*Math.abs(t-i)+Math.abs(t-e)*Math.abs(t-e)+Math.abs(i-e)*Math.abs(i-e))/65535*50+1}).getMostProminentColor(this.image);t.r&&t.g&&t.b&&(this.curtain.style.background="rgb("+t.r+","+t.g+","+t.b+")"),this.anchor.appendChild(this.curtain)}},a.prototype.changeAnimationDelay=function(t){this.curtain&&(this.curtain.style.WebkitAnimationDelay=t+"ms",this.curtain.style.animationDelay=t+"ms"),this.image&&(this.image.style.WebkitAnimationDelay=t+"ms",this.image.style.animationDelay=t+"ms"),this.desc&&(this.desc.style.WebkitAnimationDelay=t+"ms",this.desc.style.animationDelay=t+"ms")},r.prototype.options={minDelay:0,maxDelay:500,viewportFactor:0},r.prototype._init=function(){var i=this,e=[];[].slice.call(this.el.children).forEach(function(t){var i=new a(t);e.push(i)}),this.items=e,this.itemsCount=this.items.length,this.itemsRenderedCount=0,this.didScroll=!1,imagesLoaded(this.el,function(){classie.add(i.el,"loaded"),new Masonry(i.el,{itemSelector:"li",isFitWidth:!0,transitionDuration:0}),i.items.forEach(function(t){s(t.el)?(++i.itemsRenderedCount,classie.add(t.el,"shown")):(t.addCurtain(),t.changeAnimationDelay(Math.random()*(i.options.maxDelay-i.options.minDelay)+i.options.minDelay))});var e=function(){i.didScroll||(i.didScroll=!0,setTimeout(function(){i._scrollPage()},200)),i.itemsRenderedCount===i.itemsCount&&t.removeEventListener("scroll",e,!1)};t.addEventListener("scroll",e,!1),t.addEventListener("resize",function(){i._resizeHandler()},!1)})},r.prototype._scrollPage=function(){var t=this;this.items.forEach(function(i){if(!classie.has(i.el,"shown")&&!classie.has(i.el,"animate")&&s(i.el,t.options.viewportFactor)){if(++t.itemsRenderedCount,!i.curtain)return void classie.add(i.el,"shown");classie.add(i.el,"animate");var e=function(){c.animations&&this.removeEventListener(h,e),classie.remove(i.el,"animate"),classie.add(i.el,"shown")};c.animations?i.curtain.addEventListener(h,e):e()}}),this.didScroll=!1},r.prototype._resizeHandler=function(){function t(){i._scrollPage(),i.resizeTimeout=null}var i=this;this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(t,1e3)},t.GridScrollFx=r}(window);
